---
title: Route Protection
description: Layered approach to protect routes on client and server.
---

## Layer 1: Route Rules

Declarative protection in `nuxt.config.ts`. Covers 90% of use cases:

```ts
export default defineNuxtConfig({
  routeRules: {
    '/app/**': { auth: 'user' },
    '/login': { auth: 'guest' },
    '/admin/**': { auth: { user: { role: 'admin' } } },
    '/staff/**': { auth: { user: { role: ['admin', 'moderator'] } } },
  },
})
```

## Layer 2: Page Meta

Per-page overrides using `definePageMeta`. Same syntax as `routeRules`:

```ts
definePageMeta({
  auth: 'user',
})

// Or with user matching
definePageMeta({
  auth: { user: { role: 'admin' } },
})

// Custom redirect
definePageMeta({
  auth: { only: 'user', redirectTo: '/subscribe' },
})
```

## Layer 3: Custom Middleware

For complex client-side logic, create standard Nuxt route middleware:

```ts
// middleware/premium.ts
export default defineNuxtRouteMiddleware(() => {
  const { user } = useUserSession()

  if (!user.value?.subscription?.active) {
    return navigateTo('/pricing')
  }
})
```

```ts
// pages/premium.vue
definePageMeta({
  middleware: 'premium',
})
```

## Layer 4: Server API Protection

Use `requireUserSession()` for server-side checks:

```ts
// server/api/admin/stats.get.ts
export default defineEventHandler(async (event) => {
  const { user } = await requireUserSession(event)

  // User is guaranteed to exist
  return { stats: await getStats(user.id) }
})
```

With user matching:

```ts
// server/api/admin/users.get.ts
export default defineEventHandler(async (event) => {
  await requireUserSession(event, { user: { role: 'admin' } })

  return { users: await getAllUsers() }
})
```

## Module Configuration

```ts
// nuxt.config.ts
export default defineNuxtConfig({
  auth: {
    redirects: {
      login: '/login',   // Where to send unauthenticated users
      guest: '/',        // Where to send authenticated users from guest-only pages
    },
  },
})
```

## AuthMeta Types

| Value | Description |
|-------|-------------|
| `false` | Public, no checks |
| `'guest'` | Unauthenticated only |
| `'user'` | Authenticated only |
| `{ only?, redirectTo?, user? }` | Object form with options |

Object form options:
- `only: 'guest' | 'user'` - access restriction
- `redirectTo: string` - custom redirect path
- `user: UserMatch` - match against user properties

## UserMatch Syntax

Match user properties for fine-grained access control:

```ts
// Exact match - user.role must equal 'admin'
{ user: { role: 'admin' } }

// OR logic - user.role must be 'admin' OR 'moderator'
{ user: { role: ['admin', 'moderator'] } }

// AND logic - multiple fields must all match
{ user: { role: 'admin', verified: true } }

// Combined - role is admin OR moderator, AND verified is true
{ user: { role: ['admin', 'moderator'], verified: true } }
```

## See Also

- [How It Works](/core-concepts/how-it-works)
- [Security Caveats](/core-concepts/security-caveats)
- [API Protection Guide](/guides/api-protection)
