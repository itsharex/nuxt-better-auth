---
title: Configuration
description: Configure the module options and your Better Auth server instance.
navigation.icon: i-lucide-settings
---

## Module Configuration

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  modules: ['@onmax/nuxt-better-auth'],
  auth: {
    redirects: {
      login: '/login',
      guest: '/',
      // logout: '/goodbye', // optional
    },
    preserveRedirect: true,
    redirectQueryKey: 'redirect',
  },
  routeRules: {
    '/app/**': { auth: { only: 'user', redirectTo: '/login' } },
    '/login': { auth: { only: 'guest', redirectTo: '/app' } },
  },
})
```

::field-group
  ::field{name="clientOnly" type="boolean"}
    Default: `false`

    Enable client-only mode for external auth backends. When `true`:
    - Skips `server/auth.config.ts` requirement
    - Skips server-side setup (API handlers, middleware, schema generation, devtools)
    - Skips secret validation

    Use this when your Better Auth server runs on a separate backend (e.g., standalone h3/Nitro project).

    See [External Auth Backend](/guides/external-auth-backend) guide.
  ::

  ::field{name="serverConfig" type="string"}
    Default: `'server/auth.config'`

    Path to the server auth config file, relative to the project root.
  ::

  ::field{name="clientConfig" type="string"}
    Default: `'app/auth.config'`

    Path to the client auth config file, relative to the project root.
  ::

  ::field{name="redirects" type="{ login?: string, guest?: string, logout?: string }"}
    Default: `{ login: '/login', guest: '/' }`

    Global redirect fallbacks:
    - `login`: where to redirect unauthenticated users
    - `guest`: where to redirect authenticated users trying to access guest-only routes
    - `logout`: where to navigate after logout (no default)

    Per-route `redirectTo` takes precedence when set.
  ::

  ::field{name="preserveRedirect" type="boolean"}
    Default: `true`

    When redirecting unauthenticated users to a login route, append the original requested path as a query param.

    Configure redirect targets per-route with `routeRules.auth.redirectTo` or `definePageMeta({ auth: { redirectTo } })`.
  ::

  ::field{name="redirectQueryKey" type="string"}
    Default: `'redirect'`

    Query param key used when `preserveRedirect` is enabled.
  ::

  ::field{name="hubSecondaryStorage" type="boolean | 'custom'"}
    Default: `false`

    Enable secondary storage for sessions, reducing database hits for session validation.

    - `true` — Use NuxtHub KV. Requires [NuxtHub Integration](/integrations/nuxthub) with `hub: { kv: true }`. Build fails if KV is not enabled.
    - `'custom'` — You provide your own `secondaryStorage` in `defineServerAuth()` (required; the build fails in production if missing). The module won't inject NuxtHub KV but will omit the session table from the generated schema.
    - `false` (default) — No secondary storage from the module. User-provided `secondaryStorage` in `defineServerAuth()` is not overridden.
  ::

  ::field{name="schema.usePlural" type="boolean"}
    Default: `false`

    Pluralize table names (user → users)
  ::

  ::field{name="schema.casing" type="'camelCase' | 'snake_case'"}
    Default: `camelCase`

    Column/table name casing. Falls back to `hub.db.casing` when not specified.
  ::
::

## Redirect Targets (RouteRules-First)

Prefer redirect paths on route-level auth config:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  routeRules: {
    '/app/**': { auth: { only: 'user', redirectTo: '/login' } },
    '/login': { auth: { only: 'guest', redirectTo: '/app' } },
  },
})
```

If `redirectTo` is omitted, shorthand fallbacks apply:
- `auth: 'user'` falls back to `/login`
- `auth: 'guest'` falls back to `/`

If you want global defaults for those fallbacks, use `auth.redirects`.

## Server Configuration

Define your authentication logic in `server/auth.config.ts`, including plugins, providers, and settings.

### defineServerAuth

Use the `defineServerAuth` helper to ensure type safety and access context. It accepts an object or function syntax.

```ts [server/auth.config.ts]
import { defineServerAuth } from '@onmax/nuxt-better-auth/config'

// Object syntax (simplest)
export default defineServerAuth({
  emailAndPassword: { enabled: true }
})

// Function syntax (access context)
export default defineServerAuth((ctx) => ({
  emailAndPassword: { enabled: true }
}))
```

::note
The module automatically injects `secret` and `baseURL`. You don't need to configure these in `defineServerAuth`.
- **Secret**: Priority: `nuxt.config.ts` runtimeConfig > `NUXT_BETTER_AUTH_SECRET` > `BETTER_AUTH_SECRET`
- **Base URL**: The module auto-detects the base URL on Vercel/Cloudflare/Netlify. For other platforms, set `NUXT_PUBLIC_SITE_URL`
::

### Context Options

When using the function syntax, `defineServerAuth` callback receives a context object with useful properties:

```ts [server/auth.config.ts]
import { defineServerAuth } from '@onmax/nuxt-better-auth/config'

export default defineServerAuth((ctx) => ({
  emailAndPassword: { enabled: true },

  // Access the database connection via ctx.db when using NuxtHub
  // Example: pass ctx.db to your own plugin/helper.
  // Do not set `database` here when using module-managed adapters.
  appName: ctx.runtimeConfig.public.siteUrl ? 'Better Auth App' : 'Better Auth',

  // Access runtime config if needed
  // someValue: ctx.runtimeConfig.customKey
}))
```

### Session Enrichment

You can enrich session payloads with Better Auth's `custom-session` plugin through `plugins` in `defineServerAuth`. This module does not provide a separate `appSession.enrich` option.

See the full recipe in [Server Utilities](/api/server-utils#session-enrichment-with-custom-session).

## Base URL Configuration

The module resolves `siteUrl` using this priority:

| Priority | Source | When Used |
|----------|--------|-----------|
| 1 | `runtimeConfig.public.siteUrl` | Explicit config (always wins) |
| 2 | Request URL | Auto-detected from the current Nitro request (`event`) |
| 3 | `VERCEL_URL`, `CF_PAGES_URL`, `URL` | Platform env vars (Vercel, Cloudflare, Netlify) |
| 4 | `http://localhost:3000` | Development only |

In server handlers, pass `event` to `serverAuth(event)` so request URL detection can run. In non-request contexts (seed scripts, tasks, startup plugins), the module uses environment/platform fallbacks.

Set an explicit site URL in `nuxt.config.ts` for deterministic OAuth callbacks and origin checks:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  runtimeConfig: {
    public: {
      siteUrl: process.env.NUXT_PUBLIC_SITE_URL || 'http://localhost:3000',
    },
  },
})
```

Use `NUXT_PUBLIC_SITE_URL` to provide this value per environment.

**Custom domains or self-hosted**: You should set `runtimeConfig.public.siteUrl` (or `NUXT_PUBLIC_SITE_URL`) when using custom domains or deploying to your own VPS/server. Platform env vars return auto-generated URLs, not your custom domain.

```ini [.env]
NUXT_PUBLIC_SITE_URL="https://your-domain.com"
```

::note
The module can auto-detect the request URL on most deployments. You should still set `runtimeConfig.public.siteUrl` (or `NUXT_PUBLIC_SITE_URL`) when callback consistency matters, such as local OAuth debugging, custom domains, or non-request contexts like seed scripts.
::

## Runtime Config

Configure secrets using environment variables (see [Installation](/getting-started/installation#set-environment-variables)).

```ini [.env]
BETTER_AUTH_SECRET="your-super-secret-key"
NUXT_PUBLIC_SITE_URL="https://your-domain.com" # Optional on Vercel/Cloudflare/Netlify
```

::tip
Prefix the variable with `NUXT_` to use Nuxt's runtime config system (recommended for multi-environment deployments): `NUXT_BETTER_AUTH_SECRET=`
::

## For Module Authors

Other Nuxt modules can extend the authentication configuration:

```ts
// In your Nuxt module
export default defineNuxtModule({
  setup(options, nuxt) {
    nuxt.hook('better-auth:config:extend', (config) => {
      config.plugins = [...(config.plugins || []), myPlugin()]
    })
  }
})
```

Access sessions from server handlers:

```ts
const { user, session } = await getUserSession(event)
if (!user) throw createError({ statusCode: 401 })
```

::callout{icon="i-lucide-arrow-right" to="/getting-started/client-setup"}
Next, set up the **Client Configuration**.
::
